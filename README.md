# 淨水場水質監測地圖

一個實時顯示台灣淨水場水質監測數據的 Web 應用程式。

## 功能特性

- 🗺️ **互動式地圖** - 使用 Leaflet 地圖庫顯示全台灣 46 個淨水場位置
- 📊 **即時數據** - 每小時自動從政府官方網站讀取最新的水質資料
- 💧 **水質指標** - 顯示 pH 值、濁度 (NTU)、殘餘氯濃度等重要指標
- 🔍 **搜尋功能** - 快速搜尋特定淨水場
- 📍 **色彩標記** - 根據水質狀況用不同顏色標記位置
  - 🟢 綠色：優秀 (濁度 ≤ 0.5)
  - 🔵 藍色：良好 (濁度 ≤ 1.0)
  - 🟡 黃色：中等 (濁度 ≤ 2.0)
  - 🔴 紅色：需要關注 (濁度 > 2.0)
  - ⚫ 灰色：數據不完整

## 安裝與執行

### 需求
- Node.js 14+
- npm

### 步驟

1. **安裝依賴**
   ```bash
   npm install
   ```

2. **啟動伺服器**
   ```bash
   npm start
   ```

3. **開啟瀏覽器**
   ```
   http://localhost:3000
   ```

   或如果 3000 已被占用，可使用：
   ```bash
   PORT=3001 npm start
   ```
   然後訪問 `http://localhost:3001`

## 專案結構

```
adts_map/
├── public/
│   ├── index.html      # HTML 主頁面
│   ├── style.css       # 樣式表
│   └── map.js          # 前端邏輯 (地圖、搜尋、互動)
├── server.js           # Express 後端伺服器
├── package.json        # 專案依賴配置
└── README.md          # 本文件
```

## 使用說明

### 查看地圖
- 默認顯示整個台灣的淨水場分布
- 點擊地圖標記查看該淨水場的詳細水質數據

### 搜尋淨水場
1. 在右側邊欄的搜尋框中輸入淨水場名稱
2. 列表會自動過濾匹配的結果
3. 點擊列表項可跳轉到該位置並顯示詳細信息

### 手動刷新數據
- 點擊右上角的「🔄 立即刷新」按鈕立即更新數據
- 應用會自動顯示最後更新的時間

### 自動更新
- 應用會在後台每小時自動從官方網站更新一次數據
- 無需手動操作，數據會自動刷新

## 數據來源

水質數據來自臺灣自來水公司的開放資料：
- **API 端點**: https://www.water.gov.tw/wq/XML/ADTS.json
- **更新頻率**: 每小時

## API 端點

### 取得水質數據
```
GET /api/water-data
```
返回：
```json
{
  "data": [
    {
      "station_name": "新山淨水場",
      "pH_value": "6.7",
      "turbidity(NTU)": "0.21",
      "residual_chlorine(mg/L)": "0.81",
      "longitude": 121.718767,
      "latitude": 25.13137
    }
  ],
  "lastUpdated": "2025-11-30T12:00:00.000Z",
  "count": 46
}
```

### 查詢伺服器狀態
```
GET /api/status
```
返回：
```json
{
  "lastUpdated": "2025-11-30T12:00:00.000Z",
  "dataCount": 46,
  "serverTime": "2025-11-30T12:05:00.000Z"
}
```

### 健康檢查
```
GET /health
```

## 技術棧

### 後端
- **Express.js** - Web 伺服器框架
- **Axios** - HTTP 請求庫
- **CORS** - 跨來源資源共享

### 前端
- **HTML5 / CSS3 / JavaScript** - 基礎 Web 技術
- **Leaflet** - 開源地圖庫
- **Leaflet Control Geocoder** - 地理編碼搜尋

## 瀏覽器相容性

- Chrome / Edge (最新版本)
- Firefox (最新版本)
- Safari (最新版本)
- 支援行動裝置 (平板、手機)

## 開發與擴展

### 修改資料更新頻率

編輯 `server.js`，修改以下代碼的時間間隔：
```javascript
setInterval(() => {
  fetchWaterData();
}, 60 * 60 * 1000); // 改為所需的毫秒數
```

### 自訂地圖樣式

編輯 `public/style.css` 修改顏色、佈局等樣式。

### 添加新功能

- 在 `server.js` 中添加新的 API 端點
- 在 `public/map.js` 中添加前端邏輯

## 常見問題

**Q: 為什麼某些淨水場的數據是「無資料」？**
A: 這是由於政府資料源中該淨水場沒有提供該項測量數據。

**Q: 多久更新一次數據？**
A: 應用會每小時自動從官方網站更新一次資料。你也可以點擊「立即刷新」按鈕手動更新。

**Q: 可以在本地離線使用嗎？**
A: 不行，因為應用需要連接到官方的水質資料 API。

## 許可證

MIT License

## 聯絡與支持

如有任何問題或建議，請提出 Issue 或 Pull Request。

---

**最後更新**: 2025-11-30
